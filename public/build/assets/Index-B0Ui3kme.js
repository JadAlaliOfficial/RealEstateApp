import{r as x,j as e,H as U,a as d}from"./app-DqMOGD98.js";import{C as q,a as z,b as G}from"./card-CSHkU0E3.js";import{u as J}from"./usePermissions-D3YX7w9A.js";import{A as K}from"./app-layout-DVdbg0be.js";import M from"./EmptyState-BiCxvisr.js";import Q from"./FilterBar-DnfeSJwq.js";import W from"./PageHeader-udwU0gLW.js";import X from"./PaginationInfo-BOJP7a8B.js";import Y from"./TaskTable-BFvQrQZi.js";import Z from"./VendorTaskTrackerCreateDrawer-DAt_nBRy.js";import ee from"./VendorTaskTrackerEditDrawer-CNfQj13_.js";import{f as re}from"./format-DUNHsrA7.js";import"./app-Dca6SbuN.js";import"./utils-CBfrqCZ4.js";import"./index-BywuZfe1.js";import"./index-CdJFUDDL.js";import"./button-CnCxC_fs.js";import"./index-Djaw7FEN.js";import"./index-CE-j_Hk-.js";import"./index-TpMpjpzk.js";import"./index-DV4B2SfL.js";import"./index-CIOEicCU.js";import"./index-D-mU1EC4.js";import"./x-yklQ_FSb.js";import"./createLucideIcon-YTrgT1D8.js";import"./index-Dc_FVRD7.js";import"./index-BLBWFuLc.js";import"./index-B550RzFm.js";import"./index-b6qhGiqr.js";import"./collapsible-BcdYj7Xk.js";import"./chevron-right-B1lMLKBg.js";import"./index-Dtsi8hpy.js";import"./log-out-urF-BNH0.js";import"./chevrons-up-down-B3QdoLm1.js";import"./app-logo-icon-Cd-9JgQ1.js";import"./house-BQ3D9ktz.js";import"./building-BUhrYFz0.js";import"./users-mGsNkM0E.js";import"./wrench-YCbkTjb_.js";import"./credit-card-Ca7VjIpG.js";import"./dollar-sign-Bm-HU048.js";import"./file-text-DZtHCDd-.js";import"./triangle-alert-dm5wZJU6.js";import"./bell-V4baUFac.js";import"./input-CHeP_7PN.js";import"./chevron-down-CVFkLqo9.js";import"./search-DmG9ZvIp.js";import"./download-CwRiJglj.js";import"./plus-CCQ1HvB4.js";import"./table-DhaitHv5.js";import"./TaskTableRow-7LZ9LCBH.js";import"./badge-CdyTx-24.js";import"./eye-Hz_BelNN.js";import"./eye-off-TKSRjyRo.js";import"./square-pen-DyjCcft1.js";import"./trash-2-D82ivj7i.js";import"./drawer-CLiudX9t.js";import"./CitySection-Djx67l2E.js";import"./label-CYMNIGLH.js";import"./popover-XOewc--E.js";import"./command-BQtaQ7wa.js";import"./check-DearYqlO.js";import"./PropertySection-COGtrXq0.js";import"./UnitSection-CJStHnG2.js";import"./VendorSection-C74scO2y.js";import"./TaskSubmissionDateSection-CPGVTP3H.js";import"./calendar-B935ji8J.js";import"./chevron-left-ge3DLFDW.js";import"./calendar-DgXDA8Yw.js";import"./ScheduledVisitsSection-BeYtcFaT.js";import"./TaskEndingDateSection-DpjjalXC.js";import"./AssignedTasksSection-DhAPlvUu.js";import"./NotesSection-F2abnbyp.js";import"./StatusSection-Dg2y2L5g.js";import"./radioGroup-D2Ap-vWb.js";import"./index-BfJTGFlI.js";import"./UrgencySection-JmjXtq6H.js";import"./CitySelector-ermq6uzo.js";import"./FormSection-BflAmTQR.js";import"./PropertySelector-BvBYFqqE.js";import"./UnitSelector-DRTAPUou.js";import"./VendorSelector-B5LVlYqp.js";import"./DatePickerField-XEhVTITq.js";import"./TextAreaField-B7iMG6zE.js";import"./StatusRadioGroup-BZIkIwfm.js";import"./UrgencyRadioGroup-B40HhZl2.js";const h=(t,r="-")=>{if(!t)return r;const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(t);if(!l)return r;const[,u,g,c]=l,m=new Date(Number(u),Number(g)-1,Number(c));return re(m,"P")},te=(t,r="vendor-tasks.csv")=>{const u=[["ID","City","Property","Unit Name","Vendor Name","Submission Date","Assigned Tasks","Scheduled Visits","Task End Date","Notes","Status","Urgent"].join(","),...t.map(a=>[a.id,`"${a.city||""}"`,`"${a.property_name||""}"`,`"${a.unit_name||""}"`,`"${a.vendor_name||""}"`,`"${h(a.task_submission_date,"")}"`,`"${(a.assigned_tasks||"").replace(/"/g,'""')}"`,`"${h(a.any_scheduled_visits,"")}"`,`"${h(a.task_ending_date,"")}"`,`"${(a.notes||"").replace(/"/g,'""')}"`,`"${a.status||""}"`,`"${a.urgent}"`].join(","))].join(`
`),g=new Blob([u],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),m=URL.createObjectURL(g);c.setAttribute("href",m),c.setAttribute("download",r),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(m)};function Ir({tasks:t,filters:r,units:l,cities:u,properties:g,vendors:c,drawerCities:m,drawerProperties:a,drawerUnits:f,drawerVendors:j,drawerUnitsByCity:S,drawerPropertiesByCity:k,drawerUnitsByProperty:y,drawerVendorsByCity:_}){const{hasPermission:E,hasAnyPermission:O,hasAllPermissions:C}=J(),[P,N]=x.useState(!1),[$,v]=x.useState(!1),[w,b]=x.useState(!1),[D,T]=x.useState(null),A=()=>v(!1),I=()=>{b(!1),T(null)},B=o=>{T(o),b(!0)},V=o=>{if(confirm("Are you sure you want to archive this task?")){const p={};Object.entries(r).forEach(([n,i])=>{i!=null&&i!==""&&(p[n]=String(i))}),d.delete(route("vendor-task-tracker.destroy",o.id),{data:{redirect_filters:p},preserveState:!0,preserveScroll:!0})}},L=()=>{if(t.data.length===0){alert("No data to export");return}N(!0);try{const o=`vendor-tasks-${new Date().toISOString().split("T")[0]}.csv`;te(t.data,o)}catch(o){console.error("Export failed:",o),alert("Export failed. Please try again.")}finally{N(!1)}},R=o=>{const p={};Object.entries(o).forEach(([n,i])=>{i!=null&&i!==""&&(p[n]=String(i))}),r.per_page&&r.per_page!==""&&(p.per_page=String(r.per_page)),p.page="1",d.get(route("vendor-task-tracker.index"),p,{preserveState:!0,preserveScroll:!0})},F=()=>{const o={};r.per_page&&r.per_page!==""&&(o.per_page=String(r.per_page)),o.page="1",d.get(route("vendor-task-tracker.index"),o,{preserveState:!0,preserveScroll:!0})},H={canView:E("vendor-task-tracker.show"),canEdit:C(["vendor-task-tracker.edit","vendor-task-tracker.update"]),canDelete:E("vendor-task-tracker.destroy"),hasAnyPermission:O(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])};return e.jsxs(K,{children:[e.jsx(U,{title:"Vendor Task Tracker"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(W,{onExport:L,onAddTask:()=>v(!0),isExporting:P,hasExportData:t.data.length>0,canCreate:C(["vendor-task-tracker.create","vendor-task-tracker.store"])}),e.jsxs(q,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(z,{children:e.jsx(Q,{filters:r,cities:u,properties:g,units:l,vendors:c,onSearch:R,onClear:F})}),e.jsx(G,{children:t.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Y,{tasks:t.data,formatDateOnly:h,onEdit:B,onDelete:V,permissions:H,filters:r}),e.jsx(X,{meta:t.meta}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Per page:"}),e.jsxs("select",{className:"h-9 rounded-md border border-input bg-background px-2 text-sm",value:r.per_page??"15",onChange:o=>{const p=o.target.value,n={};Object.entries(r).forEach(([i,s])=>{s!=null&&s!==""&&(n[i]=String(s))}),n.per_page=p,n.page="1",d.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},children:[e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"30",children:"30"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"all",children:"All"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)<=1,onClick:()=>{const p=Number(t.meta?.current_page??1)-1,n={};Object.entries(r).forEach(([i,s])=>{s!=null&&s!==""&&(n[i]=String(s))}),n.page=String(p),d.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",t.meta?.current_page??1," of ",t.meta?.last_page??1]}),e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)>=(t.meta?.last_page??1),onClick:()=>{const p=Number(t.meta?.current_page??1)+1,n={};Object.entries(r).forEach(([i,s])=>{s!=null&&s!==""&&(n[i]=String(s))}),n.page=String(p),d.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},children:"Next"})]})]})]}):e.jsx(M,{})})]})]})}),e.jsx(Z,{cities:m,properties:a,units:f,vendors:j,unitsByCity:S,propertiesByCity:k,unitsByProperty:y,vendorsByCity:_,filters:r,open:$,onOpenChange:v,onSuccess:A}),D&&e.jsx(ee,{task:D,cities:m,properties:a,units:f,vendors:j,unitsByCity:S,propertiesByCity:k,unitsByProperty:y,vendorsByCity:_,filters:r,open:w,onOpenChange:b,onSuccess:I})]})}export{Ir as default};
