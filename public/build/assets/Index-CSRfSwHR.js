import{r as c,u as T,j as o,H as R,a as m}from"./app-DqMOGD98.js";import{A as k}from"./app-layout-DVdbg0be.js";import{C as H,a as U,b as M}from"./card-CSHkU0E3.js";import{u as V}from"./usePermissions-D3YX7w9A.js";import B from"./PropertyCreateDrawer-C8KAABM6.js";import Q from"./PropertyEditDrawer-6xEKWJdx.js";import q from"./PropertyPageHeader-D0FaPGF0.js";import z from"./PropertyFilters-DglBz0JJ.js";import G from"./PropertyTable-mYZkK0Ni.js";import J from"./PropertyEmptyState-E-UBMXis.js";import K from"./FlashMessages-QgqEfdhY.js";import W from"./PropertyPagination-rdqDGJVa.js";import"./app-Dca6SbuN.js";import"./index-BywuZfe1.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-CnCxC_fs.js";import"./index-Djaw7FEN.js";import"./index-CE-j_Hk-.js";import"./index-TpMpjpzk.js";import"./index-DV4B2SfL.js";import"./index-CIOEicCU.js";import"./index-D-mU1EC4.js";import"./x-yklQ_FSb.js";import"./createLucideIcon-YTrgT1D8.js";import"./index-Dc_FVRD7.js";import"./index-BLBWFuLc.js";import"./index-B550RzFm.js";import"./index-b6qhGiqr.js";import"./collapsible-BcdYj7Xk.js";import"./chevron-right-B1lMLKBg.js";import"./index-Dtsi8hpy.js";import"./log-out-urF-BNH0.js";import"./chevrons-up-down-B3QdoLm1.js";import"./app-logo-icon-Cd-9JgQ1.js";import"./house-BQ3D9ktz.js";import"./building-BUhrYFz0.js";import"./users-mGsNkM0E.js";import"./wrench-YCbkTjb_.js";import"./credit-card-Ca7VjIpG.js";import"./dollar-sign-Bm-HU048.js";import"./file-text-DZtHCDd-.js";import"./triangle-alert-dm5wZJU6.js";import"./bell-V4baUFac.js";import"./drawer-CLiudX9t.js";import"./CitySelectionSection-B8iNPSs1.js";import"./label-CYMNIGLH.js";import"./popover-XOewc--E.js";import"./command-BQtaQ7wa.js";import"./search-DmG9ZvIp.js";import"./map-pin-Y0hOSGql.js";import"./check-DearYqlO.js";import"./PropertySelectionSection-BAtQFf9b.js";import"./alert-Bzzz3l9Z.js";import"./building-2-C4fTWrtj.js";import"./circle-alert-D7Jbmc3S.js";import"./InsuranceCompanySection-CEQJVTa2.js";import"./input-CHeP_7PN.js";import"./shield-BIGtDbc1.js";import"./AmountPolicySection-DaWSaFnm.js";import"./DatesSection-DVmhqrGH.js";import"./calendar-DgXDA8Yw.js";import"./NotesSection-BmLwVLAz.js";import"./textarea-Bttm1uXI.js";import"./InsuranceCompanyField-Ch3WznEM.js";import"./AmountPolicyFields-DhfPZbmy.js";import"./DateFields-ErJsbZUI.js";import"./NotesField-DtWiS88T.js";import"./download-CwRiJglj.js";import"./plus-CCQ1HvB4.js";import"./table-DhaitHv5.js";import"./PropertyTableRow-BijUhZbS.js";import"./PropertyStatusBadge-Dgm0Liy5.js";import"./badge-CdyTx-24.js";import"./PropertyDaysLeftBadge-CVzwi3RB.js";import"./eye-Hz_BelNN.js";import"./square-pen-DyjCcft1.js";import"./trash-2-D82ivj7i.js";import"./pagination-CNoaZKZK.js";import"./chevron-left-ge3DLFDW.js";import"./select-CcLqZ2DM.js";import"./index-BfJTGFlI.js";import"./chevron-down-CVFkLqo9.js";import"./chevron-up-D2gF9iAP.js";const X=(t,l="properties.csv")=>{const d=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],u=i=>{const h=new Date,x=new Date(i).getTime()-h.getTime();return Math.ceil(x/(1e3*60*60*24))},f=[d.join(","),...t.map(i=>[i.id,`"${i.property?.property_name||"N/A"}"`,`"${i.insurance_company_name}"`,`"${i.formatted_amount}"`,`"${i.effective_date}"`,`"${i.policy_number}"`,`"${i.expiration_date}"`,u(i.expiration_date),`"${i.status}"`].join(","))].join(`
`),g=new Blob([f],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),r=URL.createObjectURL(g);p.setAttribute("href",r),p.setAttribute("download",l),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(r)};function vt({properties:t,filters:l,cities:d=[],availableProperties:u=[]}){const{hasPermission:f,hasAnyPermission:g,hasAllPermissions:p}=V(),[r,i]=c.useState(l),[h,y]=c.useState(!1),[x,_]=c.useState(!1),[b,S]=c.useState(!1),[D,w]=c.useState(null),{flash:j}=T().props,n=l?.per_page??t.per_page,P=()=>{const e={};return t.current_page&&t.current_page>1&&(e.page=t.current_page.toString()),n&&(e.per_page=n.toString()),Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),e},E=()=>{const e={};return r.property_name&&(e.filter_property_name=String(r.property_name)),r.insurance_company_name&&(e.filter_insurance_company_name=String(r.insurance_company_name)),r.policy_number&&(e.filter_policy_number=String(r.policy_number)),typeof r.status<"u"&&r.status!==null&&(e.filter_status=String(r.status)),n&&(e.filter_per_page=String(n)),t.current_page&&t.current_page>1&&(e.filter_page=String(t.current_page)),e},C=(e,a)=>{const s={...r,[e]:a};i(s)},v=()=>{const e={};Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),n&&(e.per_page=n.toString()),m.get(route("properties-info.index"),e,{preserveState:!0,preserveScroll:!0})},A=()=>{i({property_name:"",insurance_company_name:"",policy_number:"",status:void 0});const a={};n&&(a.per_page=n.toString()),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},F=e=>{confirm("Are you sure you want to delete this property?")&&m.delete(route("properties-info.destroy",e.id),{data:E(),preserveState:!0,preserveScroll:!0})},O=()=>{if(t.data.length===0){alert("No data to export");return}y(!0);try{const e=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;X(t.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{y(!1)}},I=()=>{S(!1),m.get(route("properties-info.index"),P(),{preserveState:!0,preserveScroll:!0})},N=e=>{w(e),S(!0)},$=e=>{const a=P();delete a.page,a.per_page=e.toString(),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},L=e=>{const a=P();m.get(route("properties-info.show",e.id),a,{preserveState:!1})};return o.jsxs(k,{children:[o.jsx(R,{title:"Properties Insurance"}),o.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:o.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[o.jsx(K,{success:j?.success,error:j?.error}),o.jsx(q,{onExport:O,onAddProperty:()=>_(!0),isExporting:h,hasExportData:t.data.length>0,canCreate:p(["properties.create","properties.store"])}),o.jsxs(H,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(U,{children:o.jsx(z,{filters:r,onFilterChange:C,onSearch:v,onClear:A})}),o.jsxs(M,{children:[o.jsx(G,{properties:t.data,onEdit:N,onDelete:F,onShow:L,canEdit:p(["properties.update","properties.edit"]),canDelete:f("properties.destroy"),canShow:f("properties.show"),hasAnyActionPermission:g(["properties.destroy","properties.update","properties.edit","properties.show"])}),t.data.length===0&&o.jsx(J,{}),t.data.length>0&&o.jsx(W,{paginatedData:t,currentPerPage:n||15,onPerPageChange:$})]})]})]})}),o.jsx(B,{open:x,onOpenChange:_,cities:d,availableProperties:u,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15}),D&&o.jsx(Q,{open:b,onOpenChange:S,property:D,availableProperties:u,onSuccess:I,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15,cities:d})]})}export{vt as default};
