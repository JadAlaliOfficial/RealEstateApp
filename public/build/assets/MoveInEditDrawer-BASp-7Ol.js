import{r as d,u as ae,j as r}from"./app-D539PDEN.js";import{B as A}from"./button--IN0CSyb.js";import{D as _e,a as oe,b as se}from"./drawer-BOU8hUx7.js";import{I as K}from"./input-DQBwF3pd.js";import U from"./FormSection-D6PuWL6Z.js";import de from"./DatePickerField-C3hlqcV0.js";import le from"./CitySelector-C1lpidFA.js";import fe from"./PropertySelector-CAXiwqxK.js";import me from"./UnitSelector-Cz6CJp9R.js";import ce from"./LeaseSigningSection-D0kbE7JU.js";import ue from"./MoveInDetailsSection-DO5jLUJd.js";import pe from"./PaymentSection-BecxsQjc.js";import he from"./KeysAndFormsSection-Dxsscgwv.js";import ge from"./InsuranceSection-CExfn1Od.js";import"./app-DvnMLx2o.js";import"./index-CituRSkQ.js";import"./utils-CBfrqCZ4.js";import"./index-MQL96Sqq.js";import"./index-BA2VIff1.js";import"./index-D9RoX9VL.js";import"./index-Coh7aVBC.js";import"./index-DECShoH4.js";import"./index-u_jnU6es.js";import"./x-DO94m97V.js";import"./createLucideIcon-4b2xxMBa.js";import"./label-D-ManEYT.js";import"./calendar-CrKHAktI.js";import"./format-DUNHsrA7.js";import"./chevron-right-B8Ihb2tS.js";import"./chevron-down-B9OnTpGY.js";import"./popover-uWV6s5Ev.js";import"./index-BtSfnK06.js";import"./calendar-pGwOw633.js";import"./command-CjlHw1Dl.js";import"./search-Dil3k9X7.js";import"./chevrons-up-down-28SbtDvw.js";import"./check-tZNcpeuV.js";import"./RadioGroupField-B7YPtg5B.js";import"./radioGroup-Cwca0D5V.js";import"./index-BWOOmq3Y.js";import"./index-DnE1pg1s.js";function at({moveIn:t,units:T,cities:z,properties:v,unitsByProperty:u,open:Y,onOpenChange:F,onSuccess:q,currentFilters:p,currentPerPage:H,currentPage:Q}){const E=d.useRef(null),j=d.useRef(null),N=d.useRef(null),[W,h]=d.useState(""),[G,D]=d.useState(""),[J,C]=d.useState(""),[X,O]=d.useState([]),[Z,k]=d.useState([]),[S,P]=d.useState(""),[b,x]=d.useState(""),[f,R]=d.useState({lease_signing_date:!1,move_in_date:!1,scheduled_paid_time:!1,move_in_form_sent_date:!1,date_of_move_in_form_filled:!1,date_of_insurance_expiration:!1,last_notice_sent:!1}),m=(e,i)=>{R(n=>({...n,[e]:i}))},B=()=>{if(!t.unit_id)return{cityId:"",propertyId:""};const e=T.find(n=>n.id===t.unit_id);if(!e)return{cityId:"",propertyId:""};const i=v.find(n=>n.property_name===e.property_name);return i?{cityId:i.city_id?.toString()||"",propertyId:i.id.toString()}:{cityId:"",propertyId:""}},{cityId:c,propertyId:l}=B(),o=e=>{if(!e)return"";const i=String(e).match(/^(\d{4}-\d{2}-\d{2})/);if(i)return i[1];try{const n=new Date(e);if(!isNaN(n.getTime())){const $=n.getFullYear(),M=String(n.getMonth()+1).padStart(2,"0"),re=String(n.getDate()).padStart(2,"0");return`${$}-${M}-${re}`}}catch{}return""},g=e=>o(e)||null,y=e=>{if(!e)return{first:"",last:""};const i=e.trim();if(!i)return{first:"",last:""};const n=i.indexOf(" ");return n===-1?{first:i,last:""}:{first:i.slice(0,n),last:i.slice(n+1)}},{data:_,setData:a,put:I,processing:V,errors:s}=ae({unit_id:t.unit_id??"",signed_lease:t.signed_lease??"No",lease_signing_date:o(t.lease_signing_date),move_in_date:o(t.move_in_date),paid_security_deposit_first_month_rent:t.paid_security_deposit_first_month_rent??"No",scheduled_paid_time:o(t.scheduled_paid_time),handled_keys:t.handled_keys??"No",move_in_form_sent_date:o(t.move_in_form_sent_date),filled_move_in_form:t.filled_move_in_form??"No",date_of_move_in_form_filled:g(t.date_of_move_in_form_filled),submitted_insurance:t.submitted_insurance??"No",date_of_insurance_expiration:g(t.date_of_insurance_expiration),first_name:y(t.tenant_name).first,last_name:y(t.tenant_name).last,last_notice_sent:o(t.last_notice_sent)});d.useEffect(()=>{a({unit_id:t.unit_id??"",signed_lease:t.signed_lease??"No",lease_signing_date:o(t.lease_signing_date),move_in_date:o(t.move_in_date),paid_security_deposit_first_month_rent:t.paid_security_deposit_first_month_rent??"No",scheduled_paid_time:o(t.scheduled_paid_time),handled_keys:t.handled_keys??"No",move_in_form_sent_date:o(t.move_in_form_sent_date),filled_move_in_form:t.filled_move_in_form??"No",date_of_move_in_form_filled:g(t.date_of_move_in_form_filled),submitted_insurance:t.submitted_insurance??"No",date_of_insurance_expiration:g(t.date_of_insurance_expiration),first_name:y(t.tenant_name).first,last_name:y(t.tenant_name).last,last_notice_sent:o(t.last_notice_sent)}),P(c),x(l),w(),R({lease_signing_date:!1,move_in_date:!1,scheduled_paid_time:!1,move_in_form_sent_date:!1,date_of_move_in_form_filled:!1,date_of_insurance_expiration:!1,last_notice_sent:!1})},[t.id]),d.useEffect(()=>{P(c),x(l)},[c,l]),d.useEffect(()=>{if(c){const e=v.filter(i=>i.city_id?.toString()===c);k(e)}l&&u[l]&&O(u[l])},[c,l,v,u]);const w=()=>{h(""),D(""),C("")},ee=e=>{if(P(e),x(""),a("unit_id",""),D(""),C(""),h(""),e){const i=v.filter(n=>n.city_id?.toString()===e);k(i)}else k([]);O([])},te=e=>{x(e),a("unit_id",""),C(""),h(""),e&&u&&u[e]?O(u[e]):O([])},ie=e=>{a("unit_id",parseInt(e)),h("")},L=e=>{e.preventDefault(),h(""),D(""),C("");let i=!1;if((!S||S.trim()==="")&&(D("Please select a city before submitting the form."),j.current&&(j.current.focus(),j.current.scrollIntoView({behavior:"smooth",block:"center"})),i=!0),(!b||b.trim()==="")&&(C("Please select a property before submitting the form."),N.current&&(N.current.focus(),N.current.scrollIntoView({behavior:"smooth",block:"center"})),i=!0),(!_.unit_id||typeof _.unit_id!="number"||_.unit_id<=0)&&(h("Please select a unit before submitting the form."),E.current&&(E.current.focus(),E.current.scrollIntoView({behavior:"smooth",block:"center"})),i=!0),i)return;const n={};p.city?.trim()&&(n.city=p.city.trim()),p.property?.trim()&&(n.property=p.property.trim()),p.unit?.trim()&&(n.unit=p.unit.trim()),n.perPage=H,n.page=String(Q);const M=`${route("move-in.update",t.id)}?${new URLSearchParams(n).toString()}`;I(M,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{w(),F(!1),q?.()}})},ne=()=>{a({unit_id:t.unit_id??"",signed_lease:t.signed_lease??"No",lease_signing_date:o(t.lease_signing_date),move_in_date:o(t.move_in_date),paid_security_deposit_first_month_rent:t.paid_security_deposit_first_month_rent??"No",scheduled_paid_time:o(t.scheduled_paid_time),handled_keys:t.handled_keys??"No",move_in_form_sent_date:o(t.move_in_form_sent_date),filled_move_in_form:t.filled_move_in_form??"No",date_of_move_in_form_filled:g(t.date_of_move_in_form_filled),submitted_insurance:t.submitted_insurance??"No",date_of_insurance_expiration:g(t.date_of_insurance_expiration),first_name:y(t.tenant_name).first,last_name:y(t.tenant_name).last,last_notice_sent:o(t.last_notice_sent)}),P(c),x(l),w(),F(!1)};return r.jsx(_e,{open:Y,onOpenChange:F,modal:!1,children:r.jsx(oe,{size:"half",title:`Edit Move-In Record #${t.id}`,children:r.jsxs("div",{className:"flex h-full flex-col",children:[r.jsx("div",{className:"flex-1 overflow-auto p-6",children:r.jsxs("form",{onSubmit:L,className:"space-y-4",children:[r.jsx(le,{cities:z,selectedCityId:S,onCityChange:ee,cityRef:j,error:G||(s.unit_id?"Please select a valid unit.":void 0)}),r.jsx(fe,{properties:Z,selectedPropertyId:b,onPropertyChange:te,propertyRef:N,disabled:!S,selectedCityId:S,error:J}),r.jsx(me,{units:X,selectedUnitId:_.unit_id,onUnitChange:ie,unitRef:E,disabled:!b,selectedPropertyId:b,validationError:W,error:s.unit_id}),r.jsx(ce,{signedLease:_.signed_lease,onSignedLeaseChange:e=>a("signed_lease",e),leaseSigningDate:_.lease_signing_date,onLeaseSigningDateChange:e=>a("lease_signing_date",e),isCalendarOpen:f.lease_signing_date,onCalendarOpenChange:e=>m("lease_signing_date",e),signedLeaseError:s.signed_lease,dateError:s.lease_signing_date}),r.jsx(ue,{moveInDate:_.move_in_date,onMoveInDateChange:e=>a("move_in_date",e),isCalendarOpen:f.move_in_date,onCalendarOpenChange:e=>m("move_in_date",e),error:s.move_in_date}),r.jsx(pe,{paidSecurityDeposit:_.paid_security_deposit_first_month_rent,onPaidSecurityDepositChange:e=>a("paid_security_deposit_first_month_rent",e),scheduledPaidTime:_.scheduled_paid_time,onScheduledPaidTimeChange:e=>a("scheduled_paid_time",e),isCalendarOpen:f.scheduled_paid_time,onCalendarOpenChange:e=>m("scheduled_paid_time",e),paidError:s.paid_security_deposit_first_month_rent,dateError:s.scheduled_paid_time}),r.jsx(he,{handledKeys:_.handled_keys,onHandledKeysChange:e=>a("handled_keys",e),moveInFormSentDate:_.move_in_form_sent_date,onMoveInFormSentDateChange:e=>a("move_in_form_sent_date",e),filledMoveInForm:_.filled_move_in_form,onFilledMoveInFormChange:e=>{a("filled_move_in_form",e),e!=="Yes"&&a("date_of_move_in_form_filled",null)},dateOfMoveInFormFilled:_.date_of_move_in_form_filled??"",onDateOfMoveInFormFilledChange:e=>a("date_of_move_in_form_filled",e),formSentCalendarOpen:f.move_in_form_sent_date,onFormSentCalendarOpenChange:e=>m("move_in_form_sent_date",e),formFilledCalendarOpen:f.date_of_move_in_form_filled,onFormFilledCalendarOpenChange:e=>m("date_of_move_in_form_filled",e),handledKeysError:s.handled_keys,formSentDateError:s.move_in_form_sent_date,filledFormError:s.filled_move_in_form,formFilledDateError:s.date_of_move_in_form_filled}),r.jsx(ge,{submittedInsurance:_.submitted_insurance,onSubmittedInsuranceChange:e=>{a("submitted_insurance",e),e!=="Yes"&&a("date_of_insurance_expiration",null)},dateOfInsuranceExpiration:_.date_of_insurance_expiration??"",onDateOfInsuranceExpirationChange:e=>a("date_of_insurance_expiration",e),isCalendarOpen:f.date_of_insurance_expiration,onCalendarOpenChange:e=>m("date_of_insurance_expiration",e),submittedError:s.submitted_insurance,dateError:s.date_of_insurance_expiration}),r.jsx(U,{label:"First Name",borderColor:"border-l-blue-500",error:s.first_name,children:r.jsx(K,{id:"first_name",name:"first_name",value:_.first_name,onChange:e=>a("first_name",e.target.value),placeholder:"Enter first name"})}),r.jsx(U,{label:"Last Name",borderColor:"border-l-blue-500",error:s.last_name,children:r.jsx(K,{id:"last_name",name:"last_name",value:_.last_name,onChange:e=>a("last_name",e.target.value),placeholder:"Enter last name"})}),r.jsx(U,{label:"Last Notice Sent",borderColor:"border-l-blue-500",error:s.last_notice_sent,children:r.jsx(de,{value:_.last_notice_sent,onChange:e=>a("last_notice_sent",e??""),isOpen:f.last_notice_sent,onOpenChange:e=>m("last_notice_sent",e)})})]})}),r.jsx(se,{children:r.jsxs("div",{className:"flex w-full justify-end gap-2",children:[r.jsx(A,{type:"button",variant:"outline",onClick:ne,children:"Cancel"}),r.jsx(A,{type:"submit",disabled:V,onClick:L,children:V?"Updating...":"Update Move-In Record"})]})})]})})})}export{at as default};
