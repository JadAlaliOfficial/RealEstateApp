import{r as m,u as Q,j as o,H as W,a as u}from"./app-DqMOGD98.js";import{C as X,a as Y,b as Z}from"./card-CSHkU0E3.js";import{u as ee}from"./usePermissions-D3YX7w9A.js";import{A as te}from"./app-layout-DVdbg0be.js";import re from"./ApplicationCreateDrawer-Cez6ho_2.js";import oe from"./ApplicationEditDrawer-BHajHKSJ.js";import ie from"./ApplicationsTable-DBixbYGY.js";import se from"./EmptyState-DqBNIiCH.js";import ae from"./FilterBar-CtbJVCtD.js";import ne from"./FlashMessages-BRszBrhM.js";import pe from"./PageHeader-DAn37DvS.js";import me from"./Pagination-YsWaLHjP.js";import"./app-Dca6SbuN.js";import"./utils-CBfrqCZ4.js";import"./index-BywuZfe1.js";import"./index-CdJFUDDL.js";import"./button-CnCxC_fs.js";import"./index-Djaw7FEN.js";import"./index-CE-j_Hk-.js";import"./index-TpMpjpzk.js";import"./index-DV4B2SfL.js";import"./index-CIOEicCU.js";import"./index-D-mU1EC4.js";import"./x-yklQ_FSb.js";import"./createLucideIcon-YTrgT1D8.js";import"./index-Dc_FVRD7.js";import"./index-BLBWFuLc.js";import"./index-B550RzFm.js";import"./index-b6qhGiqr.js";import"./collapsible-BcdYj7Xk.js";import"./chevron-right-B1lMLKBg.js";import"./index-Dtsi8hpy.js";import"./log-out-urF-BNH0.js";import"./chevrons-up-down-B3QdoLm1.js";import"./app-logo-icon-Cd-9JgQ1.js";import"./house-BQ3D9ktz.js";import"./building-BUhrYFz0.js";import"./users-mGsNkM0E.js";import"./wrench-YCbkTjb_.js";import"./credit-card-Ca7VjIpG.js";import"./dollar-sign-Bm-HU048.js";import"./file-text-DZtHCDd-.js";import"./triangle-alert-dm5wZJU6.js";import"./bell-V4baUFac.js";import"./drawer-CLiudX9t.js";import"./CityPropertyUnitSelector-DAYYk9iq.js";import"./label-CYMNIGLH.js";import"./popover-XOewc--E.js";import"./command-BQtaQ7wa.js";import"./search-DmG9ZvIp.js";import"./check-DearYqlO.js";import"./ApplicantInformationSection-0L236VTS.js";import"./input-CHeP_7PN.js";import"./select-CcLqZ2DM.js";import"./index-BfJTGFlI.js";import"./chevron-down-CVFkLqo9.js";import"./chevron-up-D2gF9iAP.js";import"./application-CnwOiERd.js";import"./StatusAndDateSection-K__w36dA.js";import"./calendar-B935ji8J.js";import"./format-DUNHsrA7.js";import"./chevron-left-ge3DLFDW.js";import"./radioGroup-D2Ap-vWb.js";import"./calendar-DgXDA8Yw.js";import"./AdditionalDetailsSection-DOjuHjPM.js";import"./ApplicantInformationFields-D9vLNvj0.js";import"./AttachmentField-kMvBtApd.js";import"./rotate-ccw-gCDCWh_-.js";import"./CityPropertyUnitSelector-eLYcy048.js";import"./CurrentSelectionDisplay-t9wel29h.js";import"./StageAndNotesFields-DBbIoHLo.js";import"./StatusAndDateFields-X3uF8ACp.js";import"./table-DhaitHv5.js";import"./ApplicationsTableRow-BGeS7bw3.js";import"./badge-CdyTx-24.js";import"./eye-Hz_BelNN.js";import"./square-pen-DyjCcft1.js";import"./eye-off-TKSRjyRo.js";import"./trash-2-D82ivj7i.js";import"./download-CwRiJglj.js";import"./plus-CCQ1HvB4.js";import"./pagination-CNoaZKZK.js";const ce=(r,c="applications.csv")=>{try{const i=t=>t==null?"":String(t).replace(/"/g,'""'),h=t=>!t||!/^(\d{4})-(\d{2})-(\d{2})/.exec(t)?"":t.substring(0,10),f=t=>!t||t.length===0?"":t.map(n=>n.name).join("; "),g=[["ID","City","Property","Unit","Name","Co-signer","Status","Applicant Applied From","Date","Stage in Progress","Notes","Attachments Count","Attachment Names"].join(","),...r.map(t=>{try{return[t.id||"",`"${i(t.city)}"`,`"${i(t.property)}"`,`"${i(t.unit_name)}"`,`"${i(t.name)}"`,`"${i(t.co_signer)}"`,`"${i(t.status)}"`,`"${i(t.applicant_applied_from)}"`,`"${h(t.date)}"`,`"${i(t.stage_in_progress)}"`,`"${i(t.notes)}"`,t.attachments?.length||0,`"${f(t.attachments)}"`].join(",")}catch(n){return console.error("Error processing application row:",t,n),""}}).filter(t=>t!=="")].join(`
`),_=new Blob([g],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),l=URL.createObjectURL(_);return a.setAttribute("href",l),a.setAttribute("download",c),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l),!0}catch(i){throw console.error("CSV Export Error:",i),i}};function Rt({applications:r,filters:c,cities:i,properties:h,units:f,filterCities:j,filterProperties:g,filterUnits:_}){const[a,l]=m.useState(!1),[t,n]=m.useState(!1),[w,E]=m.useState(null),[v,P]=m.useState(!1),{flash:A}=Q().props,{hasPermission:C,hasAnyPermission:y,hasAllPermissions:F}=ee(),[s,x]=m.useState({city:"",property:"",unit:"",name:"",applicant_applied_from:"",is_hidden:!1}),b=c?.per_page?String(c.per_page):String(r?.per_page??15),[d,D]=m.useState(b===String(r?.total??"")?"all":b);m.useEffect(()=>{const e=c||{};x({city:e.city||"",property:e.property||"",unit:e.unit||"",name:e.name||"",applicant_applied_from:e.applicant_applied_from||"",is_hidden:!!e.is_hidden||!1})},[c]);const S=()=>({filter_city:s.city||"",filter_property:s.property||"",filter_unit:s.unit||"",filter_name:s.name||"",filter_applicant_applied_from:s.applicant_applied_from||"",filter_is_hidden:s.is_hidden?"true":"",per_page:d,page:r.current_page}),$=e=>{x(e);const p={...e,per_page:d,page:1};e.is_hidden||delete p.is_hidden,u.get(route("applications.index"),p,{preserveState:!0,preserveScroll:!0})},O=()=>{x({city:"",property:"",unit:"",name:"",applicant_applied_from:"",is_hidden:!1}),D("15"),u.get(route("applications.index"),{per_page:"15",page:1},{preserveState:!1})},k=e=>{confirm("Are you sure you want to delete this application?")&&u.delete(route("applications.destroy",e.id),{data:S(),preserveState:!0,preserveScroll:!0})},N=e=>{confirm("Are you sure you want to hide this application?")&&u.patch(route("applications.hide",e.id),S(),{preserveState:!0,preserveScroll:!0})},U=e=>{confirm("Are you sure you want to unhide this application?")&&u.patch(route("applications.unhide",e.id),S(),{preserveState:!0,preserveScroll:!0})},H=()=>{if(!r||!r.data||r.data.length===0){alert("No data to export");return}P(!0);try{const e=`applications-${new Date().toISOString().split("T")[0]}.csv`;ce(r.data,e)}catch(e){console.error("Export failed:",e),alert(`Export failed: ${e instanceof Error?e.message:"Unknown error"}`)}finally{P(!1)}},I=()=>l(!1),L=()=>{n(!1),E(null)},R=e=>{E(e),n(!0)},V=(j||[]).map((e,p)=>({id:p+1,name:e})),B={0:(g||[]).map((e,p)=>({id:p+1,name:e,city_id:0}))},T={0:(_||[]).map((e,p)=>({id:p+1,name:e,property_id:0}))},M=F(["applications.create","applications.store"]),q=C("applications.show"),z=y(["applications.edit","applications.update"]),G=C("applications.destroy"),J=y(["applications.hide","applications.update"]),K=y(["applications.show","applications.edit","applications.update","applications.destroy","applications.hide"]);return o.jsxs(te,{children:[o.jsx(W,{title:"Applications"}),o.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:o.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[o.jsx(ne,{success:A?.success,error:A?.error}),o.jsx(pe,{onExport:H,onAddNew:()=>l(!0),isExporting:v,hasExportData:!!(r?.data&&r.data.length>0),hasCreatePermission:M}),o.jsxs(X,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(Y,{children:o.jsx(ae,{cities:V,properties:B,units:T,initialFilters:s,onSearch:$,onClear:O})}),o.jsx(Z,{children:r.data.length>0?o.jsxs(o.Fragment,{children:[o.jsx(ie,{applications:r.data,onEdit:R,onDelete:k,onHide:N,onUnhide:U,hasViewPermission:q,hasEditPermission:z,hasDeletePermission:G,hasHidePermission:J,hasAnyActionPermission:K,filters:s}),o.jsx(me,{links:r.links,meta:{current_page:r.current_page,last_page:r.last_page,per_page:r.per_page,total:r.total,from:r.from,to:r.to},filters:s,perPage:d,onPerPageChange:D})]}):o.jsx(se,{})})]})]})}),o.jsx(re,{cities:i,properties:h,units:f,open:a,onOpenChange:l,onSuccess:I,currentFilters:s,perPage:d,page:r.current_page}),w&&o.jsx(oe,{application:w,cities:i,properties:h,units:f,open:t,onOpenChange:n,onSuccess:L,currentFilters:s,perPage:d,page:r.current_page})]})}export{Rt as default};
