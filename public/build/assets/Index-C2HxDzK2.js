import{r as u,j as r,H as z,a as l}from"./app-DqMOGD98.js";import{C as M,b as B}from"./card-CSHkU0E3.js";import{u as G}from"./usePermissions-D3YX7w9A.js";import{A as J}from"./app-layout-DVdbg0be.js";import X from"./MoveInCreateDrawer-D23Xv-vb.js";import Y from"./MoveInEditDrawer-BYRSem4U.js";import I from"./PageHeader-BBgmcwH2.js";import ee from"./MoveInFilters-DBeUN3EA.js";import te from"./MoveInTable-BuLdLv93.js";import re from"./EmptyState-CNxqbC65.js";import ie from"./PaginationInfo-CK9SU5qZ.js";import"./app-Dca6SbuN.js";import"./utils-CBfrqCZ4.js";import"./index-BywuZfe1.js";import"./index-CdJFUDDL.js";import"./button-CnCxC_fs.js";import"./index-Djaw7FEN.js";import"./index-CE-j_Hk-.js";import"./index-TpMpjpzk.js";import"./index-DV4B2SfL.js";import"./index-CIOEicCU.js";import"./index-D-mU1EC4.js";import"./x-yklQ_FSb.js";import"./createLucideIcon-YTrgT1D8.js";import"./index-Dc_FVRD7.js";import"./index-BLBWFuLc.js";import"./index-B550RzFm.js";import"./index-b6qhGiqr.js";import"./collapsible-BcdYj7Xk.js";import"./chevron-right-B1lMLKBg.js";import"./index-Dtsi8hpy.js";import"./log-out-urF-BNH0.js";import"./chevrons-up-down-B3QdoLm1.js";import"./app-logo-icon-Cd-9JgQ1.js";import"./house-BQ3D9ktz.js";import"./building-BUhrYFz0.js";import"./users-mGsNkM0E.js";import"./wrench-YCbkTjb_.js";import"./credit-card-Ca7VjIpG.js";import"./dollar-sign-Bm-HU048.js";import"./file-text-DZtHCDd-.js";import"./triangle-alert-dm5wZJU6.js";import"./bell-V4baUFac.js";import"./drawer-CLiudX9t.js";import"./CityPropertyUnitSelector-Dzk40DU1.js";import"./label-CYMNIGLH.js";import"./popover-XOewc--E.js";import"./command-BQtaQ7wa.js";import"./search-DmG9ZvIp.js";import"./check-DearYqlO.js";import"./LeaseInformationFields-DpIqZGP9.js";import"./radioGroup-D2Ap-vWb.js";import"./index-BfJTGFlI.js";import"./DatePickerField-ZtT87CM5.js";import"./calendar-B935ji8J.js";import"./format-DUNHsrA7.js";import"./chevron-left-ge3DLFDW.js";import"./chevron-down-CVFkLqo9.js";import"./calendar-DgXDA8Yw.js";import"./PaymentInformationFields-LCUYKUlm.js";import"./KeysAndFormsFields-iQ_HxQNW.js";import"./InsuranceInformationFields-DJUQ_Jn0.js";import"./input-CHeP_7PN.js";import"./FormSection-DViNHpJp.js";import"./DatePickerField-WBtEhkgp.js";import"./CitySelector-DUvIl3aA.js";import"./PropertySelector-n-GQ1atI.js";import"./UnitSelector-DcBNzsOV.js";import"./LeaseSigningSection-BkIDRJhK.js";import"./RadioGroupField-B0cs-Ne7.js";import"./MoveInDetailsSection-tnEI4NF6.js";import"./PaymentSection-CkVQyaHN.js";import"./KeysAndFormsSection-B2s67jL1.js";import"./InsuranceSection-GxCoHdEt.js";import"./download-CwRiJglj.js";import"./plus-CCQ1HvB4.js";import"./table-DhaitHv5.js";import"./MoveInTableRow-5yafvtnl.js";import"./badge-CdyTx-24.js";import"./square-pen-DyjCcft1.js";import"./eye-off-TKSRjyRo.js";import"./eye-Hz_BelNN.js";import"./trash-2-D82ivj7i.js";const oe=(i,n="move-ins.csv")=>{try{const a=t=>{if(!t)return"";try{const h=new Date(t);return isNaN(h.getTime())?"":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"}).format(h)}catch{return t||""}},d=t=>t==null?"":String(t).replace(/"/g,'""'),S=[["ID","City","Property Name","Unit Name","Tenant Name","Signed Lease","Lease Signing Date","Move-In Date","Paid Security & First Month","Scheduled Payment Date","Handled Keys","Move in form sent On","Filled Move-In Form","Date of move in form filled in","Submitted Insurance","Date of Insurance expiration","Last Notice Sent"].join(","),...i.map(t=>{try{return[t.id||"",`"${d(t.city_name)}"`,`"${d(t.property_name)}"`,`"${d(t.unit_name)}"`,`"${d(t.tenant_name)}"`,`"${d(t.signed_lease)}"`,`"${a(t.lease_signing_date)}"`,`"${a(t.move_in_date)}"`,`"${d(t.paid_security_deposit_first_month_rent)}"`,`"${a(t.scheduled_paid_time)}"`,`"${d(t.handled_keys)}"`,`"${a(t.move_in_form_sent_date)}"`,`"${d(t.filled_move_in_form)}"`,`"${a(t.date_of_move_in_form_filled)}"`,`"${d(t.submitted_insurance)}"`,`"${a(t.date_of_insurance_expiration)}"`,`"${a(t.last_notice_sent)}"`].join(",")}catch(h){return console.error("Error processing move-in row:",t,h),""}}).filter(t=>t!=="")].join(`
`),v=new Blob([S],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),b=URL.createObjectURL(v);return m.setAttribute("href",b),m.setAttribute("download",n),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(b),!0}catch(a){throw console.error("CSV Export Error:",a),a}};function Mt({moveIns:i,filters:n,units:a,cities:d,properties:_,unitsByProperty:S}){const[v,m]=u.useState(!1),[b,t]=u.useState(!1),[h,$]=u.useState(!1),[D,O]=u.useState(null),[s,C]=u.useState({city:n?.city||"",property:n?.property||"",unit:n?.unit||"",is_hidden:String(n?.is_hidden).toLowerCase()==="true"||n?.is_hidden===!0}),[g,E]=u.useState(n?.perPage||"15"),[P,N]=u.useState(n?.page||1);u.useEffect(()=>{C({city:n?.city||"",property:n?.property||"",unit:n?.unit||"",is_hidden:String(n?.is_hidden).toLowerCase()==="true"||n?.is_hidden===!0}),E(n?.perPage||"15"),N(n?.page||1)},[n]);const{hasPermission:w,hasAnyPermission:U}=G(),x=(e={})=>{const o={};return s.city?.trim()&&(o.city=s.city.trim()),s.property?.trim()&&(o.property=s.property.trim()),s.unit?.trim()&&(o.unit=s.unit.trim()),s.is_hidden&&(o.is_hidden="true"),o.perPage=e.perPage??g,o.page=e.page??P,o},k=e=>{C(e);const o={};e.city?.trim()&&(o.city=e.city.trim()),e.property?.trim()&&(o.property=e.property.trim()),e.unit?.trim()&&(o.unit=e.unit.trim()),e.is_hidden&&(o.is_hidden="true"),o.perPage=g,o.page=1,l.get(route("move-in.index"),o,{preserveState:!0,preserveScroll:!0})},F=()=>{C({city:"",property:"",unit:"",is_hidden:!1}),l.get(route("move-in.index"),{perPage:g,page:1},{preserveState:!0,preserveScroll:!0})},R=e=>{E(e),l.get(route("move-in.index"),x({perPage:e,page:1}),{preserveState:!0,preserveScroll:!0})},A=e=>{N(e),l.get(route("move-in.index"),x({page:e}),{preserveState:!0,preserveScroll:!0})},H=e=>{if(!confirm("Are you sure you want to delete this move-in record?"))return;const o=x(),f=`${route("move-in.destroy",e.id)}?${new URLSearchParams(Object.entries(o).reduce((c,[y,p])=>(p==null||p===""||(c[y]=String(p)),c),{})).toString()}`;l.delete(f,{preserveState:!0,preserveScroll:!0})},T=e=>{if(!confirm("Are you sure you want to hide this move-in record?"))return;const o=x(),f=`${route("move-in.hide",e.id)}?${new URLSearchParams(Object.entries(o).reduce((c,[y,p])=>(p==null||p===""||(c[y]=String(p)),c),{})).toString()}`;l.patch(f,{},{preserveState:!0,preserveScroll:!0})},Q=e=>{if(!confirm("Are you sure you want to unhide this move-in record?"))return;const o=x(),f=`${route("move-in.unhide",e.id)}?${new URLSearchParams(Object.entries(o).reduce((c,[y,p])=>(p==null||p===""||(c[y]=String(p)),c),{})).toString()}`;l.patch(f,{},{preserveState:!0,preserveScroll:!0})},V=()=>{if(!i||!i.data||i.data.length===0){alert("No data to export");return}m(!0);try{const e=`move-ins-${new Date().toISOString().split("T")[0]}.csv`;oe(i.data,e)}catch(e){console.error("Export failed:",e);const o=e instanceof Error?e.message:"Unknown error";alert(`Export failed: ${o}. Please check the console for details.`)}finally{m(!1)}},W=()=>l.reload(),K=()=>l.reload(),Z=e=>{O(e),$(!0)},j=!!s.city||!!s.property||!!s.unit||!!s.is_hidden,q=U(["move-in.hide","move-in.unhide","move-in.update"]);return r.jsxs(J,{children:[r.jsx(z,{title:"Move-In Management"}),r.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(I,{hasActiveFilters:!!j,isExporting:v,hasData:i?.data&&i.data.length>0,hasCreatePermission:w("move-in.store"),onExport:V,onCreateClick:()=>t(!0)}),r.jsx(M,{className:"bg-card text-card-foreground shadow-lg mb-6",children:r.jsx(ee,{cities:d,properties:_,units:a,initialFilters:s,onSearch:k,onClear:F,hasActiveFilters:!!j})}),r.jsx(M,{className:"bg-card text-card-foreground shadow-lg",children:r.jsxs(B,{children:[r.jsx(te,{moveIns:i.data,canEdit:w("move-in.update"),canDelete:w("move-in.destroy"),canHide:q,showActions:U(["move-in.show","move-in.edit","move-in.update","move-in.destroy","move-in.hide","move-in.unhide"]),onEdit:Z,onDelete:H,onHide:T,onUnhide:Q}),r.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm",children:"Rows per page:"}),r.jsxs("select",{className:"border rounded px-2 py-1 bg-background text-foreground",value:g,onChange:e=>R(e.target.value),children:[r.jsx("option",{value:"15",children:"15"}),r.jsx("option",{value:"30",children:"30"}),r.jsx("option",{value:"50",children:"50"}),r.jsx("option",{value:"all",children:"All"})]})]}),r.jsx("div",{className:"flex items-center gap-4",children:g!=="all"&&i?.meta?r.jsxs(r.Fragment,{children:[r.jsxs("span",{className:"text-sm",children:["Page ",i.meta?.current_page??1," of ",i.meta?.last_page??1]}),r.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",disabled:(i.meta?.current_page??1)<=1,onClick:()=>A((i.meta?.current_page??1)-1),children:"Previous"}),r.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",disabled:(i.meta?.current_page??1)>=(i.meta?.last_page??1),onClick:()=>A((i.meta?.current_page??1)+1),children:"Next"})]}):r.jsxs("span",{className:"text-sm",children:["Showing all ",i?.data?.length??0," records"]})})]}),i.data.length===0&&r.jsx(re,{hasActiveFilters:!!j}),i.meta&&r.jsx(ie,{from:i.meta.from,to:i.meta.to,total:i.meta.total,hasActiveFilters:!!j})]})})]})}),r.jsx(X,{units:a,cities:d,properties:_,unitsByProperty:S,open:b,onOpenChange:t,onSuccess:W,currentFilters:s,currentPerPage:g,currentPage:P}),D&&r.jsx(Y,{moveIn:D,units:a,cities:d,properties:_,unitsByProperty:S,open:h,onOpenChange:$,onSuccess:K,currentFilters:s,currentPerPage:g,currentPage:P})]})}export{Mt as default};
