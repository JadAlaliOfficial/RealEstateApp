import{r as x,j as e,H as U,a as d}from"./app-D539PDEN.js";import{C as q,a as z,c as G}from"./card-DlPrY5i9.js";import{u as J,A as K}from"./app-layout-5nhnzF34.js";import M from"./EmptyState-Af-a4acw.js";import Q from"./FilterBar-Cj4dyiuS.js";import W from"./PageHeader-DjUgmGHF.js";import X from"./PaginationInfo-CzHvEQYj.js";import Y from"./TaskTable-C-GHVb8_.js";import Z from"./VendorTaskTrackerCreateDrawer-CKXIiyGe.js";import ee from"./VendorTaskTrackerEditDrawer-VbyOiG2p.js";import{f as re}from"./format-DUNHsrA7.js";import"./app-DvnMLx2o.js";import"./utils-CBfrqCZ4.js";import"./index-CituRSkQ.js";import"./button--IN0CSyb.js";import"./index-MQL96Sqq.js";import"./index-BA2VIff1.js";import"./index-D9RoX9VL.js";import"./index-Coh7aVBC.js";import"./index-DECShoH4.js";import"./index-u_jnU6es.js";import"./x-DO94m97V.js";import"./createLucideIcon-4b2xxMBa.js";import"./index-Dc_FVRD7.js";import"./index-CvrhNEbR.js";import"./index-BtSfnK06.js";import"./index-BUulcyCA.js";import"./collapsible-D7QLEazv.js";import"./chevron-right-B8Ihb2tS.js";import"./index-BWOOmq3Y.js";import"./log-out-ChTmT5kx.js";import"./chevrons-up-down-28SbtDvw.js";import"./app-logo-icon-OsMzeLDo.js";import"./house-tkF6Q1eJ.js";import"./building-CG36zKrR.js";import"./users-BBWCwltq.js";import"./wrench-BtUc9pEp.js";import"./credit-card-COHSy4cr.js";import"./dollar-sign-DndUVZbp.js";import"./file-text-rLI6HIgs.js";import"./triangle-alert-BTPxwKAw.js";import"./bell-BUfx3pTP.js";import"./input-DQBwF3pd.js";import"./chevron-down-B9OnTpGY.js";import"./search-Dil3k9X7.js";import"./download-BLNfeL_6.js";import"./plus-f0NO2h0u.js";import"./table-CA4rUWkX.js";import"./TaskTableRow-BewRWfAA.js";import"./badge-C4iQTRbR.js";import"./eye-CZjSPmqV.js";import"./eye-off-IIUegSlt.js";import"./square-pen-E6zB1bZE.js";import"./trash-2-B94tWSse.js";import"./drawer-BOU8hUx7.js";import"./CitySection-DH8UK6pl.js";import"./label-D-ManEYT.js";import"./popover-uWV6s5Ev.js";import"./command-CjlHw1Dl.js";import"./check-tZNcpeuV.js";import"./PropertySection-DCvxvrIC.js";import"./UnitSection-DAQu-uQ4.js";import"./VendorSection-BnvI92f0.js";import"./TaskSubmissionDateSection-DC8L1HQ-.js";import"./calendar-CrKHAktI.js";import"./calendar-pGwOw633.js";import"./ScheduledVisitsSection-Dxc_0KuW.js";import"./TaskEndingDateSection-60L8HNCJ.js";import"./AssignedTasksSection-CrszBmFv.js";import"./NotesSection-DpUICXrd.js";import"./StatusSection-BCgD3jxR.js";import"./radioGroup-Cwca0D5V.js";import"./index-DnE1pg1s.js";import"./UrgencySection--3t3Yeml.js";import"./CitySelector-T2NuUGKx.js";import"./FormSection-DabpKz9v.js";import"./PropertySelector-sHqYlxnA.js";import"./UnitSelector-BJ6wkw1z.js";import"./VendorSelector-Bq8Ao8C_.js";import"./DatePickerField-uSXjwb9I.js";import"./TextAreaField-Cs8nhcpt.js";import"./StatusRadioGroup-BRSeDSJf.js";import"./UrgencyRadioGroup-BjlfqtJP.js";const h=(t,r="-")=>{if(!t)return r;const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(t);if(!l)return r;const[,u,g,c]=l,m=new Date(Number(u),Number(g)-1,Number(c));return re(m,"P")},te=(t,r="vendor-tasks.csv")=>{const u=[["ID","City","Property","Unit Name","Vendor Name","Submission Date","Assigned Tasks","Scheduled Visits","Task End Date","Notes","Status","Urgent"].join(","),...t.map(a=>[a.id,`"${a.city||""}"`,`"${a.property_name||""}"`,`"${a.unit_name||""}"`,`"${a.vendor_name||""}"`,`"${h(a.task_submission_date,"")}"`,`"${(a.assigned_tasks||"").replace(/"/g,'""')}"`,`"${h(a.any_scheduled_visits,"")}"`,`"${h(a.task_ending_date,"")}"`,`"${(a.notes||"").replace(/"/g,'""')}"`,`"${a.status||""}"`,`"${a.urgent}"`].join(","))].join(`
`),g=new Blob([u],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),m=URL.createObjectURL(g);c.setAttribute("href",m),c.setAttribute("download",r),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(m)};function $r({tasks:t,filters:r,units:l,cities:u,properties:g,vendors:c,drawerCities:m,drawerProperties:a,drawerUnits:f,drawerVendors:j,drawerUnitsByCity:S,drawerPropertiesByCity:k,drawerUnitsByProperty:y,drawerVendorsByCity:_}){const{hasPermission:E,hasAnyPermission:O,hasAllPermissions:C}=J(),[P,N]=x.useState(!1),[$,v]=x.useState(!1),[w,b]=x.useState(!1),[D,T]=x.useState(null),A=()=>v(!1),I=()=>{b(!1),T(null)},B=o=>{T(o),b(!0)},V=o=>{if(confirm("Are you sure you want to archive this task?")){const p={};Object.entries(r).forEach(([n,s])=>{s!=null&&s!==""&&(p[n]=String(s))}),d.delete(route("vendor-task-tracker.destroy",o.id),{data:{redirect_filters:p},preserveState:!0,preserveScroll:!0})}},L=()=>{if(t.data.length===0){alert("No data to export");return}N(!0);try{const o=`vendor-tasks-${new Date().toISOString().split("T")[0]}.csv`;te(t.data,o)}catch(o){console.error("Export failed:",o),alert("Export failed. Please try again.")}finally{N(!1)}},R=o=>{const p={};Object.entries(o).forEach(([n,s])=>{s!=null&&s!==""&&(p[n]=String(s))}),r.per_page&&r.per_page!==""&&(p.per_page=String(r.per_page)),p.page="1",d.get(route("vendor-task-tracker.index"),p,{preserveState:!0,preserveScroll:!0})},F=()=>{const o={};r.per_page&&r.per_page!==""&&(o.per_page=String(r.per_page)),o.page="1",d.get(route("vendor-task-tracker.index"),o,{preserveState:!0,preserveScroll:!0})},H={canView:E("vendor-task-tracker.show"),canEdit:C(["vendor-task-tracker.edit","vendor-task-tracker.update"]),canDelete:E("vendor-task-tracker.destroy"),hasAnyPermission:O(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])};return e.jsxs(K,{children:[e.jsx(U,{title:"Vendor Task Tracker"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(W,{onExport:L,onAddTask:()=>v(!0),isExporting:P,hasExportData:t.data.length>0,canCreate:C(["vendor-task-tracker.create","vendor-task-tracker.store"])}),e.jsxs(q,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(z,{children:e.jsx(Q,{filters:r,cities:u,properties:g,units:l,vendors:c,onSearch:R,onClear:F})}),e.jsx(G,{children:t.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Y,{tasks:t.data,formatDateOnly:h,onEdit:B,onDelete:V,permissions:H,filters:r}),e.jsx(X,{meta:t.meta}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Per page:"}),e.jsxs("select",{className:"h-9 rounded-md border border-input bg-background px-2 text-sm",value:r.per_page??"15",onChange:o=>{const p=o.target.value,n={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(n[s]=String(i))}),n.per_page=p,n.page="1",d.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},children:[e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"30",children:"30"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"all",children:"All"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)<=1,onClick:()=>{const p=Number(t.meta?.current_page??1)-1,n={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(n[s]=String(i))}),n.page=String(p),d.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",t.meta?.current_page??1," of ",t.meta?.last_page??1]}),e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)>=(t.meta?.last_page??1),onClick:()=>{const p=Number(t.meta?.current_page??1)+1,n={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(n[s]=String(i))}),n.page=String(p),d.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},children:"Next"})]})]})]}):e.jsx(M,{})})]})]})}),e.jsx(Z,{cities:m,properties:a,units:f,vendors:j,unitsByCity:S,propertiesByCity:k,unitsByProperty:y,vendorsByCity:_,filters:r,open:$,onOpenChange:v,onSuccess:A}),D&&e.jsx(ee,{task:D,cities:m,properties:a,units:f,vendors:j,unitsByCity:S,propertiesByCity:k,unitsByProperty:y,vendorsByCity:_,filters:r,open:w,onOpenChange:b,onSuccess:I})]})}export{$r as default};
