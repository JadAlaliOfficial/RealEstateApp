import{r as n,u as B,j as t,H as M,a as l}from"./app-DqMOGD98.js";import{C as z,b as G}from"./card-CSHkU0E3.js";import{u as J}from"./usePermissions-D3YX7w9A.js";import{A as K}from"./app-layout-DVdbg0be.js";import W from"./VendorCreateDrawer-3ilXcna8.js";import X from"./VendorEditDrawer-DgjyCayk.js";import Y from"./FlashMessages-BdkhQvgQ.js";import Z from"./PageHeader-BSGC6rec.js";import ee from"./VendorFilters-DgXX4MNN.js";import te from"./VendorTable-BFE4VIM9.js";import re from"./VendorPagination-Cz52XT3o.js";import"./app-Dca6SbuN.js";import"./utils-CBfrqCZ4.js";import"./index-BywuZfe1.js";import"./index-CdJFUDDL.js";import"./button-CnCxC_fs.js";import"./index-Djaw7FEN.js";import"./index-CE-j_Hk-.js";import"./index-TpMpjpzk.js";import"./index-DV4B2SfL.js";import"./index-CIOEicCU.js";import"./index-D-mU1EC4.js";import"./x-yklQ_FSb.js";import"./createLucideIcon-YTrgT1D8.js";import"./index-Dc_FVRD7.js";import"./index-BLBWFuLc.js";import"./index-B550RzFm.js";import"./index-b6qhGiqr.js";import"./collapsible-BcdYj7Xk.js";import"./chevron-right-B1lMLKBg.js";import"./index-Dtsi8hpy.js";import"./log-out-urF-BNH0.js";import"./chevrons-up-down-B3QdoLm1.js";import"./app-logo-icon-Cd-9JgQ1.js";import"./house-BQ3D9ktz.js";import"./building-BUhrYFz0.js";import"./users-mGsNkM0E.js";import"./wrench-YCbkTjb_.js";import"./credit-card-Ca7VjIpG.js";import"./dollar-sign-Bm-HU048.js";import"./file-text-DZtHCDd-.js";import"./triangle-alert-dm5wZJU6.js";import"./bell-V4baUFac.js";import"./drawer-CLiudX9t.js";import"./CityField-DRfod1a4.js";import"./label-CYMNIGLH.js";import"./popover-XOewc--E.js";import"./command-BQtaQ7wa.js";import"./search-DmG9ZvIp.js";import"./VendorNameField-Bk-wy77K.js";import"./input-CHeP_7PN.js";import"./PhoneNumberField-PBswH1xM.js";import"./plus-CCQ1HvB4.js";import"./trash-2-D82ivj7i.js";import"./EmailField-CRRXNNCI.js";import"./ServiceTypeField-dW8V12VO.js";import"./select-CcLqZ2DM.js";import"./index-BfJTGFlI.js";import"./chevron-down-CVFkLqo9.js";import"./check-DearYqlO.js";import"./chevron-up-D2gF9iAP.js";import"./CityField-2UaxcTxY.js";import"./VendorNameField-0jOSdVuQ.js";import"./PhoneNumberField-BpzCYzrL.js";import"./EmailField-DofKvvpr.js";import"./ServiceTypeField-B8ywqdo4.js";import"./download-CwRiJglj.js";import"./table-DhaitHv5.js";import"./VendorTableRow-BjZqkmWt.js";import"./square-pen-DyjCcft1.js";const oe=(i,a="vendors.csv")=>{const c=["ID","City","Vendor Name","Number","Email","Service Type"],p=r=>!r||!Array.isArray(r)||r.length===0?"":r.join("; "),y=[c.join(","),...i.map(r=>[r.id,`"${r.city?.city||"N/A"}"`,`"${r.vendor_name}"`,`"${p(r.number)}"`,`"${p(r.email)}"`,`"${p(r.service_type)}"`].join(","))].join(`
`),u=new Blob([y],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),d=URL.createObjectURL(u);o.setAttribute("href",d),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(d)};function jt({vendors:i,filters:a,cities:c}){const[,p]=n.useState(a),[y,u]=n.useState(!1),[o,d]=n.useState(!1),[r,j]=n.useState(!1),[V,A]=n.useState(null),{flash:F}=B().props,{hasPermission:C,hasAllPermissions:_}=J(),[g,w]=n.useState({city:a.city||"",vendor_name:a.vendor_name||""}),[v,N]=n.useState(a?.per_page?.toString?.()??"15"),[O,h]=n.useState(!1),f=(e,s)=>{w(m=>({...m,[e]:s}))},R=e=>{const s=e.target.value;f("city",s),h(s.length>0)},k=e=>{f("city",e.city),h(!1)},I=()=>{const e={...g,per_page:v};p(e),l.get(route("vendors.index"),e,{preserveState:!0,preserveScroll:!0})},T=()=>{const e={city:"",vendor_name:""};w(e),p(e),h(!1),l.get(route("vendors.index"),{per_page:v},{preserveState:!0,preserveScroll:!0})},L=e=>{const s=e.target.value;N(s);const m={...g,per_page:s};l.get(route("vendors.index"),m,{preserveState:!0,preserveScroll:!0})},$=()=>{if(i.data.length===0){alert("No data to export");return}u(!0);try{const e=`vendors-${new Date().toISOString().split("T")[0]}.csv`;oe(i.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{u(!1)}},U=e=>{if(!confirm("Are you sure you want to delete this vendor?"))return;const m=(()=>{try{const x=new URLSearchParams(window.location.search),S=["city","city_id","vendor_name","number","email","per_page","page"],E={};return S.forEach(P=>{const D=x.get(P);D!==null&&(E[P]=D)}),E}catch{return{}}})(),b={};[["city","filter_city"],["city_id","filter_city_id"],["vendor_name","filter_vendor_name"],["number","filter_number"],["email","filter_email"],["per_page","filter_per_page"],["page","filter_page"]].forEach(([x,S])=>{m[x]!==void 0&&(b[S]=m[x])}),l.delete(route("vendors.destroy",e.id),{preserveScroll:!0,preserveState:!0,data:b})},H=()=>{l.reload()},q=e=>{A(e),j(!0)},Q=()=>{l.reload()};return t.jsxs(K,{children:[t.jsx(M,{title:"Vendors"}),t.jsx("div",{className:"py-12",children:t.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[t.jsx(Y,{flash:F}),t.jsx(Z,{hasExportPermission:C("vendor.export"),hasCreatePermissions:_(["vendors.create","vendors.store"]),isExporting:y,onExport:$,onAddVendor:()=>d(!0)}),t.jsx(z,{children:t.jsxs(G,{className:"p-6",children:[t.jsx(ee,{tempFilters:g,cities:c,showCityDropdown:O,onTempFilterChange:f,onCityInputChange:R,onCitySelect:k,onSearchClick:I,onClearFilters:T,setShowCityDropdown:h}),t.jsx(te,{vendors:i.data,hasEditPermissions:_(["vendors.edit","vendors.update"]),hasDeletePermission:C("vendors.destroy"),onEditVendor:q,onDeleteVendor:U}),t.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page"}),t.jsxs("select",{value:v,onChange:L,className:"rounded-md border border-input bg-background px-2 py-1 text-sm shadow-sm focus:outline-none",children:[t.jsx("option",{value:"15",children:"15"}),t.jsx("option",{value:"30",children:"30"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"all",children:"All"})]})]}),t.jsx(re,{links:i.links})]})]})})]})}),t.jsx(W,{cities:c,open:o,onOpenChange:d,onSuccess:H}),t.jsx(X,{cities:c,open:r,onOpenChange:j,vendor:V,onSuccess:Q})]})}export{jt as default};
