import{r as i,b as ie,j as l}from"./app-DqMOGD98.js";import{D as se,a as oe,b as ae}from"./drawer-CLiudX9t.js";import{B}from"./button-CnCxC_fs.js";import ne from"./PaymentForm-ocbVEHC-.js";import{f as ce}from"./format-DUNHsrA7.js";import"./app-Dca6SbuN.js";import"./index-Djaw7FEN.js";import"./index-BywuZfe1.js";import"./index-CE-j_Hk-.js";import"./index-TpMpjpzk.js";import"./index-DV4B2SfL.js";import"./index-CIOEicCU.js";import"./index-D-mU1EC4.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-yklQ_FSb.js";import"./createLucideIcon-YTrgT1D8.js";import"./CityField-Cz5gqqVO.js";import"./label-CYMNIGLH.js";import"./command-BQtaQ7wa.js";import"./search-DmG9ZvIp.js";import"./popover-XOewc--E.js";import"./index-B550RzFm.js";import"./chevrons-up-down-B3QdoLm1.js";import"./check-DearYqlO.js";import"./PropertyField-C4SRJ8ZI.js";import"./UnitField-BJe8pQ-5.js";import"./DateField-BtoR6qo3.js";import"./calendar-B935ji8J.js";import"./chevron-left-ge3DLFDW.js";import"./chevron-right-B1lMLKBg.js";import"./chevron-down-CVFkLqo9.js";import"./calendar-DgXDA8Yw.js";import"./OwesField-CdkknP8R.js";import"./input-CHeP_7PN.js";import"./PaidField-pnyaab-B.js";import"./AssistanceField-Ddfy5Dgf.js";import"./checkbox-DYhg3uOp.js";import"./index-Dc_FVRD7.js";import"./index-BfJTGFlI.js";import"./index-b6qhGiqr.js";import"./PermanentField-D6X7Gxvo.js";import"./radioGroup-D2Ap-vWb.js";import"./index-Dtsi8hpy.js";import"./ReversedPaymentsField-BxKzdYww.js";import"./NotesField-DUsQqhBi.js";import"./DebugInfo-DXmxUMkB.js";function rt({payment:e,units:I,cities:M,unitsByCity:O,propertiesByCity:z,open:y,onOpenChange:E,onSuccess:$,filtersContext:s}){const b=i.useRef(null),g=i.useRef(null),v=i.useRef(null),S=i.useRef(null),w=i.useRef(null),[q,N]=i.useState(""),[G,P]=i.useState(""),[H,p]=i.useState(""),[J,V]=i.useState(""),[K,j]=i.useState(""),[L,R]=i.useState(!1),[o,U]=i.useState(""),[n,f]=i.useState(""),[_,u]=i.useState(""),{data:d,setData:c,put:Q,processing:D,errors:T,transform:W}=ie({date:"",unit_id:"",owes:"",paid:"",status:"",notes:"",reversed_payments:"",permanent:"No",has_assistance:!1,assistance_amount:"",assistance_company:""});i.useEffect(()=>{e&&y&&(c({date:e.date??"",unit_id:e.unit_id?.toString()??"",owes:e.owes?.toString()??"",paid:e.paid?.toString()??"",status:e.status??"",notes:e.notes??"",reversed_payments:e.reversed_payments??"",permanent:e.permanent??"No",has_assistance:e.has_assistance??!1,assistance_amount:e.assistance_amount?.toString()??"",assistance_company:e.assistance_company??""}),U(e.city??""),f(e.property_name??""),u(e.unit_name??""),h())},[e,y]);const h=()=>{N(""),P(""),p(""),V(""),j("")},x=()=>o?z[o]||[]:[],F=()=>o?n?I.filter(r=>r.city===o&&r.property_name===n).map(r=>r.unit_name):O[o]||[]:[],X=(r,t,a)=>{const m=I.find(k=>k.city===r&&k.property_name===t&&k.unit_name===a);return m?m.id:null};i.useEffect(()=>{o&&n&&(x().includes(n)||(f(""),u(""),c(t=>({...t,unit_id:""}))))},[o]),i.useEffect(()=>{n&&_&&(F().includes(_)||(u(""),c(t=>({...t,unit_id:""}))))},[o,n]);const Y=r=>{U(r),f(""),u(""),c(t=>({...t,unit_id:""})),h()},Z=r=>{f(r),u(""),c(t=>({...t,unit_id:""})),P(""),p("")},C=r=>{if(u(r),p(""),o&&n&&r){const t=X(o,n,r);t&&c(a=>({...a,unit_id:t.toString()}))}},ee=r=>{r&&(c(t=>({...t,date:ce(r,"yyyy-MM-dd")})),V(""),R(!1))},te=r=>{c(t=>({...t,owes:r.target.value})),j("")},A=r=>{r.preventDefault(),h();let t=!1;if((!d.date||d.date.trim()==="")&&(V("Please select a date before submitting the form."),S.current&&(S.current.focus(),S.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!o||o.trim()==="")&&(N("Please select a city before submitting the form."),b.current&&(b.current.focus(),b.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!n||n.trim()==="")&&(P("Please select a property before submitting the form."),g.current&&(g.current.focus(),g.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!_||_.trim()==="")&&(p("Please select a unit before submitting the form."),v.current&&(v.current.focus(),v.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!d.owes||d.owes.trim()==="")&&(j("Please enter the amount owed before submitting the form."),w.current&&(w.current.focus(),w.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!d.unit_id||d.unit_id.trim()==="")&&(p("Unable to identify the selected unit. Please try selecting again."),t=!0),t)return;const a={};s?.city&&(a.filter_city=s.city),s?.property&&(a.filter_property=s.property),s?.unit&&(a.filter_unit=s.unit),s?.permanent&&s.permanent.length>0&&(a.filter_permanent=s.permanent.join(",")),s?.is_hidden&&(a.filter_is_hidden="true"),s?.per_page&&(a.filter_per_page=s.per_page),s?.page&&(a.filter_page=s.page),W(m=>({...m,...a})),Q(route("payments.update",e.id),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{h(),E(!1),$?.()},onError:m=>{console.error("Form submission errors:",m)}})},re=()=>{e&&(c({date:e.date??"",unit_id:e.unit_id?.toString()??"",owes:e.owes?.toString()??"",paid:e.paid?.toString()??"",status:e.status??"",notes:e.notes??"",reversed_payments:e.reversed_payments??"",permanent:e.permanent??"No",has_assistance:e.has_assistance??!1,assistance_amount:e.assistance_amount?.toString()??"",assistance_company:e.assistance_company??""}),U(e.city??""),f(e.property_name??""),u(e.unit_name??"")),h(),R(!1),E(!1)};return l.jsx(se,{open:y,onOpenChange:E,modal:!1,children:l.jsx(oe,{size:"half",title:`Edit Payment #${e.id}`,children:l.jsxs("div",{className:"flex h-full flex-col",children:[l.jsx("div",{className:"flex-1 overflow-auto p-6",children:l.jsx(ne,{data:d,setData:c,errors:T,cities:M,selectedCity:o,selectedProperty:n,selectedUnit:_,getAvailableProperties:x,getAvailableUnits:F,handleCityChange:Y,handlePropertyChange:Z,handleUnitChange:C,handleDateChange:ee,handleOwesChange:te,calendarOpen:L,setCalendarOpen:R,cityRef:b,propertyRef:g,unitNameRef:v,dateRef:S,owesRef:w,validationError:q,propertyValidationError:G,unitValidationError:H,dateValidationError:J,owesValidationError:K,payment:e,onSubmit:A})}),l.jsx(ae,{className:"border-t bg-muted/50 p-4",children:l.jsxs("div",{className:"flex justify-end gap-2",children:[l.jsx(B,{type:"button",variant:"outline",onClick:re,disabled:D,children:"Cancel"}),l.jsx(B,{type:"submit",onClick:A,disabled:D,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:D?"Updating...":"Update Payment"})]})})]})})})}export{rt as default};
