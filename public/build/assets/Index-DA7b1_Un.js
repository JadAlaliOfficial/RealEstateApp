import{r as f,j as i,H as J,a as c}from"./app-DqMOGD98.js";import{C as X,a as Y,b as Z}from"./card-CSHkU0E3.js";import{u as O}from"./usePermissions-D3YX7w9A.js";import{A as ee}from"./app-layout-DVdbg0be.js";import te from"./MoveOutCreateDrawer-DhZeJDZY.js";import re from"./MoveOutEditDrawer-DCef4W76.js";import oe from"./MoveOutEmptyState-DbGBUfzW.js";import ie from"./MoveOutFilters-Uzb2cyVH.js";import ne from"./MoveOutPageHeader-8OtNkjzg.js";import ae from"./MoveOutPagination-BDnK8uGE.js";import se from"./MoveOutTable-CLx8r-9j.js";import{f as de}from"./format-DUNHsrA7.js";import"./app-Dca6SbuN.js";import"./utils-CBfrqCZ4.js";import"./index-BywuZfe1.js";import"./index-CdJFUDDL.js";import"./button-CnCxC_fs.js";import"./index-Djaw7FEN.js";import"./index-CE-j_Hk-.js";import"./index-TpMpjpzk.js";import"./index-DV4B2SfL.js";import"./index-CIOEicCU.js";import"./index-D-mU1EC4.js";import"./x-yklQ_FSb.js";import"./createLucideIcon-YTrgT1D8.js";import"./index-Dc_FVRD7.js";import"./index-BLBWFuLc.js";import"./index-B550RzFm.js";import"./index-b6qhGiqr.js";import"./collapsible-BcdYj7Xk.js";import"./chevron-right-B1lMLKBg.js";import"./index-Dtsi8hpy.js";import"./log-out-urF-BNH0.js";import"./chevrons-up-down-B3QdoLm1.js";import"./app-logo-icon-Cd-9JgQ1.js";import"./house-BQ3D9ktz.js";import"./building-BUhrYFz0.js";import"./users-mGsNkM0E.js";import"./wrench-YCbkTjb_.js";import"./credit-card-Ca7VjIpG.js";import"./dollar-sign-Bm-HU048.js";import"./file-text-DZtHCDd-.js";import"./triangle-alert-dm5wZJU6.js";import"./bell-V4baUFac.js";import"./drawer-CLiudX9t.js";import"./LocationSection-BQ4IuACW.js";import"./FormField-DfEkyFUG.js";import"./label-CYMNIGLH.js";import"./TextInputField-BAkNk8Bw.js";import"./input-CHeP_7PN.js";import"./popover-XOewc--E.js";import"./command-BQtaQ7wa.js";import"./search-DmG9ZvIp.js";import"./check-DearYqlO.js";import"./DateFieldsSection-BeJA0690.js";import"./DatePickerField-DQz8xdLS.js";import"./calendar-B935ji8J.js";import"./chevron-left-ge3DLFDW.js";import"./chevron-down-CVFkLqo9.js";import"./calendar-DgXDA8Yw.js";import"./PropertyDetailsSection-C2xbqAdk.js";import"./RadioGroupField-0EWC7jJ3.js";import"./radioGroup-D2Ap-vWb.js";import"./index-BfJTGFlI.js";import"./TextAreaField-DiS4-ENw.js";import"./textarea-Bttm1uXI.js";import"./StatusFieldsSection-u3Zyob8a.js";import"./LocationSelectionFields-DRmL7_NE.js";import"./MoveOutDateFields-CJARtWv3.js";import"./MoveOutDetailsFields-B0kpn_4p.js";import"./MoveOutStatusFields-D2PlU3V_.js";import"./download-CwRiJglj.js";import"./plus-CCQ1HvB4.js";import"./table-DhaitHv5.js";import"./MoveOutTableRow-DqXb6Cts.js";import"./badge-CdyTx-24.js";import"./eye-Hz_BelNN.js";import"./eye-off-TKSRjyRo.js";import"./square-pen-DyjCcft1.js";import"./trash-2-D82ivj7i.js";const b=(n,s="-")=>{if(!n)return s;const r=/^(\d{4})-(\d{2})-(\d{2})/.exec(n);if(!r)return s;const[,m,l,_]=r,d=new Date(Number(m),Number(l)-1,Number(_));return de(d,"P")},C=n=>{if(!n)return"";const s=/^(\d{4})-(\d{2})-(\d{2})/.exec(n);if(!s)return"";const[,r,m,l]=s;return`${r}-${m}-${l}`},pe=(n,s="move-outs.csv")=>{try{const r=t=>t==null?"":String(t).replace(/"/g,'""'),l=[["ID","City Name","Property Name","Unit Name","Tenants","Move Out Date","Lease Status","Lease Ending on Buildium","Keys Location","Utilities Under Our Name","Date Utility Put Under Our Name","Walkthrough","All The Devices Are Off","Repairs","Send Back Security Deposit","Notes","Cleaning","List the Unit","Renter","Move Out Form","Utility Type"].join(","),...n.map(t=>{try{return[t.id||"",`"${r(t.city_name)}"`,`"${r(t.property_name)}"`,`"${r(t.unit_name)}"`,`"${r(t.tenants)}"`,`"${b(t.move_out_date,"")}"`,`"${r(t.lease_status)}"`,`"${b(t.date_lease_ending_on_buildium,"")}"`,`"${r(t.keys_location)}"`,`"${r(t.utilities_under_our_name)}"`,`"${b(t.date_utility_put_under_our_name,"")}"`,`"${r(t.walkthrough)}"`,`"${r(t.all_the_devices_are_off)}"`,`"${r(t.repairs)}"`,`"${r(t.send_back_security_deposit)}"`,`"${r(t.notes)}"`,`"${r(t.cleaning)}"`,`"${r(t.list_the_unit)}"`,`"${r(t.renter)}"`,`"${r(t.move_out_form)}"`,`"${r(t.utility_type)}"`].join(",")}catch(j){return console.error("Error processing move-out row:",t,j),""}}).filter(t=>t!=="")].join(`
`),_=new Blob([l],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),x=URL.createObjectURL(_);return d.setAttribute("href",x),d.setAttribute("download",s),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(x),!0}catch(r){throw console.error("CSV Export Error:",r),r}};function kt({moveOuts:n,cities:s,properties:r,propertiesByCityId:m,unitsByPropertyId:l,allUnits:_,filterCities:d,filterProperties:x,filterUnits:t,perPage:j,filters:y}){const[L,E]=f.useState(!1),[A,U]=f.useState(!1),[M,D]=f.useState(!1),[g,R]=f.useState(null),[p,k]=f.useState(j??"15"),{hasPermission:F,hasAnyPermission:H,hasAllPermissions:N}=O(),S=typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams,o={city:S.get("city")||(y?.city??void 0)||void 0,property:S.get("property")||(y?.property??void 0)||void 0,unit:S.get("unit")||(y?.unit??void 0)||void 0,is_hidden:(S.get("is_hidden")||"").toLowerCase()==="true"||String(y?.is_hidden??"").toLowerCase()==="true"||y?.is_hidden===!0},v=n?.meta?.current_page??1,w=(e={})=>{const a={};return o.city&&(a.city=o.city),o.property&&(a.property=o.property),o.unit&&(a.unit=o.unit),o.is_hidden&&(a.is_hidden="true"),a.perPage=e.perPage??p,a.page=e.page??v,a},T=e=>{const a={};e.city_id&&(a.city=e.city_id),e.property_id&&(a.property=e.property_id),e.unit_id&&(a.unit=e.unit_id),e.is_hidden&&(a.is_hidden="true"),a.perPage=p,a.page=1,c.get(route("move-out.index"),a,{preserveState:!0,preserveScroll:!0})},I=()=>{c.get(route("move-out.index"),{perPage:p,page:1},{preserveState:!1,preserveScroll:!0})},V=e=>{confirm("Are you sure you want to delete this move-out record?")&&c.delete(route("move-out.destroy",e.id),{data:{redirect_city:o.city??null,redirect_property:o.property??null,redirect_unit:o.unit??null,redirect_page:String(v),redirect_perPage:p,redirect_is_hidden:o.is_hidden?"true":""},preserveState:!0,preserveScroll:!0})},W=e=>{k(e),c.get(route("move-out.index"),{...w({perPage:e,page:1})},{preserveState:!0,preserveScroll:!0})},Q=()=>{if(!n||!n.data||n.data.length===0){alert("No data to export");return}E(!0);try{const e=`move-outs-${new Date().toISOString().split("T")[0]}.csv`;pe(n.data,e)}catch(e){console.error("Export failed:",e),alert(`Export failed: ${e instanceof Error?e.message:"Unknown error"}`)}finally{E(!1)}},B=()=>c.reload(),K=()=>c.reload(),q=e=>{R(e),D(!0)},z=e=>{if(!confirm("Are you sure you want to hide this move-out record?"))return;const $=`${route("move-out.hide",e.id)}?${new URLSearchParams(Object.entries(w()).reduce((h,[P,u])=>(u==null||u===""||(h[P]=String(u)),h),{})).toString()}`;c.patch($,{},{preserveState:!0,preserveScroll:!0})},G=e=>{if(!confirm("Are you sure you want to unhide this move-out record?"))return;const $=`${route("move-out.unhide",e.id)}?${new URLSearchParams(Object.entries(w()).reduce((h,[P,u])=>(u==null||u===""||(h[P]=String(u)),h),{})).toString()}`;c.patch($,{},{preserveState:!0,preserveScroll:!0})};return i.jsxs(ee,{children:[i.jsx(J,{title:"Move-Out Management"}),i.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:i.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[i.jsx(ne,{hasCreatePermission:N(["move-out.create","move-out.store"]),isExporting:L,hasData:n?.data&&n.data.length>0,onExport:Q,onAddNew:()=>U(!0)}),i.jsxs(X,{className:"bg-card text-card-foreground shadow-lg",children:[i.jsx(Y,{children:i.jsx(ie,{cities:d,properties:x,allUnits:t,initialFilters:{city:o.city??"",property:o.property??"",unit:o.unit??"",is_hidden:o.is_hidden},onSearch:T,onClear:I})}),i.jsx(Z,{children:n.data.length>0?i.jsxs(i.Fragment,{children:[i.jsx(se,{moveOuts:n.data,formatDateOnly:b,hasPermission:F,hasAnyPermission:H,hasAllPermissions:N,onHide:z,onUnhide:G,onEdit:q,onDelete:V,filters:{city:o.city??void 0,property:o.property??void 0,unit:o.unit??void 0,is_hidden:o.is_hidden?"true":void 0,perPage:p}}),n.meta&&i.jsx(ae,{meta:n.meta,perPage:p,onPageChange:e=>{c.get(route("move-out.index"),w({page:e}),{preserveState:!0,preserveScroll:!0})}}),i.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[i.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page"}),i.jsxs("select",{value:p,onChange:e=>W(e.target.value),className:"h-9 rounded-md border border-input bg-background px-3 text-sm text-foreground",children:[i.jsx("option",{value:"15",children:"15"}),i.jsx("option",{value:"30",children:"30"}),i.jsx("option",{value:"50",children:"50"}),i.jsx("option",{value:"all",children:"All"})]})]})]}):i.jsx(oe,{})})]})]})}),i.jsx(te,{cities:s,properties:r,propertiesByCityId:m,unitsByPropertyId:l,allUnits:_,open:A,onOpenChange:U,onSuccess:B,redirectContext:{city:o.city??null,property:o.property??null,unit:o.unit??null,page:String(v),perPage:p}}),g&&i.jsx(re,{cities:s,properties:r,propertiesByCityId:m,unitsByPropertyId:l,allUnits:_,moveOut:{...g,move_out_date:C(g.move_out_date),date_lease_ending_on_buildium:C(g.date_lease_ending_on_buildium),date_utility_put_under_our_name:C(g.date_utility_put_under_our_name)},open:M,onOpenChange:D,onSuccess:K,redirectContext:{city:o.city??null,property:o.property??null,unit:o.unit??null,page:String(v),perPage:p}},g.id)]})}export{kt as default};
